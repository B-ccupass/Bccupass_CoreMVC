@using Bccupass_CoreMVC.Models.ViewModel.CreateActivity
@model List<CreateTicketViewModel>

@section Topcss {
     <link rel="stylesheet" href="~/css/CreateActivity/Ticket.css" />
}

<div class="container-md m-auto bg-white container-style">
    <div class="ticket m-auto p-5">
        <form>
            <div class="col-12 border-bottom pb-5 flex-wrap">
                <p class="mb-4">修改活動時間</p>
                @await Html.PartialAsync("_ticketSelectTimePartial")
                <!-- 新增 -->
                <p class="mb-5">新增的活動票券</p>
                <div class="overflow-auto">
                    <table class="table border accordion ticket-table"  id="accordionExample">
                        <thead class="table-dark border border-dark thead-min-width">
                        <tr>
                            <th scope="col" colspan="2" class="col-md-4">票券名稱</th>
                            <th scope="col" class="col-md-2">票券數量</th>
                            <th scope="col" colspan="2" class="col-md-3">票價</th>
                            <th scope="col" colspan="2" class="col-md-3">操作</th>
                        </tr>
                        </thead>
                        <tbody>

                            @foreach(var item in Model)
                            {
                                @await Html.PartialAsync("_ticketSettingPartial",item)
                                
                            }

                        <tr>
                            <td colspan="7" class="p-0">
                                <div class="backcolor justify-content-center align-content-center d-flex pt-4 pb-4">
                                    <button id="free" type="button" class="btn bg-white btn-add-ticket me-2"><i class="fas fa-plus icon-btn"></i>免費票</button>
                                    <button id="noFree" type="button" class="btn bg-white btn-add-ticket"><i class="fas fa-plus icon-btn"></i>付費票</button>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="mt-3 mb-5">
                <button class="btn btn-success w-100">儲存變更</button>
            </div>
            

                    

            <!-- Modal-Delete -->
            <div class="modal fade"id="DeleteModal" tabindex="-1" aria-labelledby="DeleteModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered m-auto model-width" >
                    <div class="modal-content">
                        <div class="modal-body text-center lh-lg pt-3 pe-3">
                            確定刪除票券？
                        </div>
                        <div class="modal-footer p-0 flex-nowrap">
                            <button class="btn border-0 p-1 col-6 m-0 border-end" data-bs-dismiss="modal">取消</button>
                            <button class="btn border-0 p-1 col-6 m-0 lh-lg">確認</button>
                        </div>
                    </div>
                </div>
            </div>
        </form>
            
        
        
    </div>
            
</div>

@section endJS {
    <script>
        var addFree = document.getElementById('free')
        var addNoFree = document.getElementById('noFree')
        var hour = document.getElementById('hour')

        var dataArray = []


        addFree.onclick = function(){
           var  data = {
                    ActivityDraftId:  @ViewData["ActivityDraftId"],
                    TicketName: ``,
                    Quantity: 0,
                    Price: 0,
                    Description: ``,
                    SellStartTime: ``,
                    SellEndTime: ``,
                    CheckStartTime: ``,
                    CheckEndTime: ``,
                    IsSell: false,
                    IsCheckEqualActivityTime: ``,
                    IsFree: true,
                    BuyLimitLeast: 0,
                    BuyLimitMost: 0
                }

            dataArray.push(data)

            fetch()
        }

        addNoFree.onclick = function(){
           var  data = {
                    ActivityDraftId:  @ViewData["ActivityDraftId"],
                    TicketName: ``,
                    Quantity: 0,
                    Price: 0,
                    Description: ``,
                    SellStartTime: ``,
                    SellEndTime: ``,
                    CheckStartTime: ``,
                    CheckEndTime: ``,
                    IsSell: false,
                    IsCheckEqualActivityTime: ``,
                    IsFree: false,
                    BuyLimitLeast: 0,
                    BuyLimitMost: 0
                }

            dataArray.push(data)
        }


    </script>
   


     @foreach(var item in Model){
            <script type="text/javascript">
               var  data = {
                    ActivityDraftId: @item.ActivityDraftId,
                    TicketName: `@item.TicketName`,
                    Quantity: @item.Quantity,
                    Price: @item.Price,
                    Description: `@item.Description`,
                    SellStartTime: `@item.SellStartTime`,
                    SellEndTime: `@item.SellEndTime`,
                    CheckStartTime: `@item.CheckStartTime`,
                    CheckEndTime: `@item.CheckEndTime`,
                    IsSell: @Json.Serialize(item.IsSell),
                    IsCheckEqualActivityTime: @Json.Serialize(item.IsCheckEqualActivityTime),
                    IsFree: @Json.Serialize(item.IsFree),
                    BuyLimitLeast: @item.BuyLimitLeast,
                    BuyLimitMost: @item.BuyLimitMost
                }

                dataArray.push(data)

                @*outputJson.setAttribute('value',JSON.stringify(dataArray))   *@
            </script>
     }
}